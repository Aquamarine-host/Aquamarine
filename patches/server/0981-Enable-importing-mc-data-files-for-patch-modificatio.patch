From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jake Potrebic <jake.m.potrebic@gmail.com>
Date: Mon, 22 May 2023 22:47:15 -0700
Subject: [PATCH] Enable importing mc data files for patch modification


diff --git a/build.gradle.kts b/build.gradle.kts
index 9cf389defdaeb887e9cad4f0fed3f3b95667b238..f888e3ff1d6016714e6f97fbe67dcc428e77184d 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -184,5 +184,7 @@ tasks.registerRunTask("runReobf") {
 
 tasks.registerRunTask("runDev") {
     description = "Spin up a non-relocated Mojang-mapped test server"
-    classpath(sourceSets.main.map { it.runtimeClasspath })
+    classpath(tasks.filterProjectDir.flatMap { it.outputJar })
+    classpath(sourceSets.main.map { it.runtimeClasspath.filterNot { file -> file.endsWith("minecraft.jar") } })
+    jvmArgs("-DPaper.isRunDev=true")
 }
diff --git a/src/main/java/net/minecraft/server/Main.java b/src/main/java/net/minecraft/server/Main.java
index cdbf10339a8e8846a8c364de483a0ccd95cd225a..b0b55f90cc53b8d4ccb21fccb41257ef440c5555 100644
--- a/src/main/java/net/minecraft/server/Main.java
+++ b/src/main/java/net/minecraft/server/Main.java
@@ -111,6 +111,17 @@ public class Main {
             */ // CraftBukkit end
 
         try {
+            // Paper start
+            if (Boolean.getBoolean("Paper.isRunDev")) {
+                net.minecraft.server.packs.VanillaPackResourcesBuilder.developmentConfig = builder -> {
+                    try {
+                        builder.pushAssetPath(net.minecraft.server.packs.PackType.SERVER_DATA, Paths.get(Main.class.getResource("/data/.paperassetsroot").toURI()).getParent());
+                    } catch (java.net.URISyntaxException ex) {
+                        throw new RuntimeException(ex);
+                    }
+                };
+            }
+            // Paper end
 
             Path path = (Path) optionset.valueOf("pidFile"); // CraftBukkit
 
diff --git a/src/main/resources/data/.paperassetsroot b/src/main/resources/data/.paperassetsroot
new file mode 100644
index 0000000000000000000000000000000000000000..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391
diff --git a/src/main/resources/data/minecraft/chat_type/chat.json b/src/main/resources/data/minecraft/chat_type/chat.json
index 171738fc6370527394e0e0a496861b9c82374e89..8dddf80e2a1544cf2894a9230aea4daacb83bf42 100644
--- a/src/main/resources/data/minecraft/chat_type/chat.json
+++ b/src/main/resources/data/minecraft/chat_type/chat.json
@@ -4,7 +4,7 @@
       "sender",
       "content"
     ],
-    "translation_key": "chat.type.text"
+    "translation_key": "[%s]: %s"
   },
   "narration": {
     "parameters": [
